<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valli Hospital - Designer Mode</title>
    
    <!-- PPT Generation Library -->
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

    <style>
        /* --- CORE VARIABLES (Controlled by Sliders) --- */
        :root {
            --base-font-size: 11.5pt;
            --line-height: 1.3;
            --header-scale: 1;
            --label-width: 80px; /* Controls alignment of "NAME:", "AGE:" etc */
            --cell-padding: 4px;
            --table-border-width: 1px;
            
            /* Colors */
            --color-green: #006400; /* Dark Green */
            --color-red: #cc0000;
            --color-black: #000000;
        }

        body {
            background-color: #333;
            font-family: Arial, sans-serif; /* Standard Windows Print Font */
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LEFT SIDE: A4 PREVIEW --- */
        .preview-area {
            flex: 1;
            overflow: auto;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 12mm 15mm; /* Calibrated margins */
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            box-sizing: border-box;
            position: relative;
            color: var(--color-black);
            font-size: var(--base-font-size);
            line-height: var(--line-height);
        }

        /* --- RIGHT SIDE: CONTROLS --- */
        .controls-area {
            width: 300px;
            background: #f4f4f4;
            border-left: 1px solid #ccc;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }
        
        .control-group { margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px; }
        .control-group h3 { margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: #555; }
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 12px; }
        .control-row input[type="range"] { width: 120px; }
        .control-row input[type="number"] { width: 50px; }

        .btn-main {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
        }
        .btn-ppt { background: #d24726; color: white; }
        .btn-print { background: #004e46; color: white; }

        /* --- HEADER STYLES --- */
        header { display: flex; justify-content: space-between; position: relative; margin-bottom: 15px; }
        
        .logo-wrapper { width: 100px; height: 90px; position: relative; }
        .logo-wrapper img { width: 100%; height: 100%; object-fit: contain; }

        .header-center { text-align: center; flex: 1; padding-top: 5px; transform: scale(var(--header-scale)); transform-origin: top center; }
        .h-title { color: var(--color-green); font-size: 20pt; font-weight: 700; margin: 0; }
        .h-line { width: 100%; height: 1px; background: #000; margin: 5px 0; }
        .h-sub { color: #000; font-size: 13pt; font-weight: 700; margin: 0; }
        .h-acc { color: var(--color-red); font-size: 11pt; font-weight: 700; margin-top: 2px; }

        .doc-title { text-align: center; font-weight: 700; text-decoration: underline; font-size: 12pt; margin: 10px 0 15px 0; text-transform: uppercase; }

        /* --- TABLE STYLES --- */
        table {
            width: 100%;
            border-collapse: collapse;
            border: var(--table-border-width) solid #000;
            margin-bottom: 20px;
            table-layout: fixed; /* STRICT COLUMNS */
        }
        td {
            border: var(--table-border-width) solid #000;
            padding: var(--cell-padding);
            vertical-align: top;
        }
        
        /* Column Widths (Adjustable via CSS Var if needed, but fixed for A4 usually) */
        .c1 { width: 45%; } .c2 { width: 25%; } .c3 { width: 30%; }

        /* The Label/Value aligner */
        .lbl {
            font-weight: 700;
            display: inline-block;
            width: var(--label-width); /* Key to alignment */
            white-space: nowrap;
        }
        .val { font-weight: 600; display: inline; }

        /* --- LIST STYLES --- */
        .sec-title { font-weight: 700; text-transform: uppercase; margin-top: 15px; margin-bottom: 5px; font-size: 11.5pt; }
        ul { margin: 0; padding-left: 25px; }
        li { margin-bottom: 3px; font-weight: 500; }

        /* Print Override */
        @media print {
            body { background: none; height: auto; display: block; }
            .controls-area { display: none; }
            .preview-area { padding: 0; display: block; }
            .page { width: 100%; height: auto; box-shadow: none; padding: 15mm; margin: 0 auto; }
        }
    </style>
</head>
<body>

    <!-- PREVIEW AREA -->
    <div class="preview-area">
        <div class="page" id="document-content">
            
            <header>
                <div class="logo-wrapper" id="logo1">
                    <img src="logo.png" alt="Logo" onerror="this.style.display='none'">
                </div>
                <div class="header-center">
                    <div class="h-title" contenteditable="true">Valli Super Speciality Hospital</div>
                    <div class="h-line"></div>
                    <div class="h-sub" contenteditable="true">Valli Orthopaedic & Sports Hospital</div>
                    <div class="h-acc" contenteditable="true">NABH Accredited</div>
                </div>
                <div class="logo-wrapper" id="logo2" style="margin-top: 35px;">
                    <img src="nabh.png" alt="NABH" onerror="this.style.display='none'">
                </div>
            </header>

            <div class="doc-title" contenteditable="true">DISCHARGE SUMMARY</div>

            <table>
                <colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup>
                <tr>
                    <td><span class="lbl">NAME</span>: <span class="val" contenteditable="true">Mr.TAMILSELVAN.D</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">MRN.NO</span>: <span class="val" contenteditable="true">11948</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">IP.NO</span>: <span class="val" contenteditable="true">25000307</span></td>
                </tr>
                <tr>
                    <td><span class="lbl">AGE</span>: <span class="val" contenteditable="true">29 YEARS</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">SEX</span>: <span class="val" contenteditable="true">MALE</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">R.NO</span>: <span class="val" contenteditable="true">IP-2</span></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div style="display:flex;">
                            <span class="lbl">ADDRESS</span><span style="margin-right:4px;">:</span>
                            <span class="val" contenteditable="true" style="display:block;">
                                S/O.MR. DEVARAJI,<br>
                                PALLATHUR,<br>
                                ATHI PADI,<br>
                                UTHANGARAI,<br>
                                KRISHNAGIRI.
                            </span>
                        </div>
                        <div style="margin-top: 5px;">
                            <span class="lbl">PHONE</span>: <span class="val" contenteditable="true">9843904387</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><span class="lbl">D.O.A</span>: <span class="val" contenteditable="true">21/07/25 @ 05:57 PM</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">D.O.S</span>: <span class="val" contenteditable="true">21/07/25</span></td>
                    <td><span class="lbl" style="width: auto; margin-right:5px;">D.O.D</span>: <span class="val" contenteditable="true">24/07/25 @ 03:00 PM</span></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="lbl">CONSULTANTS</span>:
                        <div class="val" style="display: inline-block; vertical-align: top; margin-left: 5px;" contenteditable="true">
                            <div style="margin-bottom:2px;">DR.T.NATANASABAPATHY MBBS, M.S(ORTHO), FDFM, IOC DSM</div>
                            <div style="margin-bottom:2px;">DR. AAKASH MBBS., M.S(ORTHO), FIJR, FDFM</div>
                            <div>DR. S. PRADEEP MBBS, MD(ANESTHESIA)</div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="3">
                        <span class="lbl">ICD CODE</span> <span class="val" style="margin-left: 140px;" contenteditable="true">M00.862</span>
                    </td>
                </tr>
            </table>

            <div class="sec-title">DIAGNOSIS:</div>
            <ul contenteditable="true">
                <li><b>SEPTIC ARTHRITIS - LEFT KNEE</b></li>
            </ul>

            <div class="sec-title">PROCEDURE:</div>
            <ul contenteditable="true">
                <li><b>ARTHROSCOPIC DEBRIDEMENT - LEFT KNEE</b></li>
            </ul>

            <div class="sec-title">CHIEF COMPLAINTS:</div>
            <ul contenteditable="true">
                <li>Patient came with discharging sinus over operated site</li>
                <li>Patient came for planned debridement under arthroscopy</li>
            </ul>

            <div class="sec-title">PAST MEDICAL HISTORY:</div>
            <ul contenteditable="true">
                <li>Status post Left Arthroscopic ACL Reconstruction x 19 days old</li>
                <li>Patient is typhoid positive since 14.07.2025 on medications</li>
                <li>Patient denies other pre existing medical illness & allergies to any medications</li>
            </ul>

            <div class="sec-title">ON EXAMINATION:</div>
            <ul contenteditable="true">
                <li>Conscious, Oriented, Afebrile</li>
                <li>Obese</li>
            </ul>

        </div>
    </div>

    <!-- CONTROLS AREA -->
    <div class="controls-area">
        <h2 style="text-align: center; margin-top: 0;">LAYOUT TUNER</h2>
        
        <button class="btn-main btn-ppt" onclick="generatePPT()">Download Editable PPT</button>
        <button class="btn-main btn-print" onclick="window.print()">Print / PDF</button>

        <div class="control-group">
            <h3>Fonts & Spacing</h3>
            <div class="control-row">
                <span>Font Size (pt)</span>
                <input type="range" min="8" max="16" step="0.5" value="11.5" oninput="setVar('--base-font-size', this.value + 'pt')">
            </div>
            <div class="control-row">
                <span>Line Height</span>
                <input type="range" min="1" max="2" step="0.05" value="1.3" oninput="setVar('--line-height', this.value)">
            </div>
        </div>

        <div class="control-group">
            <h3>Alignment</h3>
            <div class="control-row">
                <span>Label Width (px)</span>
                <input type="range" min="50" max="150" value="80" oninput="setVar('--label-width', this.value + 'px')">
            </div>
            <div class="control-row">
                <span>Cell Padding</span>
                <input type="range" min="0" max="15" value="4" oninput="setVar('--cell-padding', this.value + 'px')">
            </div>
            <div class="control-row">
                <span>Header Scale</span>
                <input type="range" min="0.5" max="1.5" step="0.1" value="1" oninput="setVar('--header-scale', this.value)">
            </div>
        </div>

        <div class="control-group">
            <h3>Move Logos</h3>
            <div class="control-row">
                <span>Left X</span>
                <input type="number" value="0" oninput="moveLogo('logo1', 'left', this.value)">
            </div>
            <div class="control-row">
                <span>Left Y</span>
                <input type="number" value="0" oninput="moveLogo('logo1', 'top', this.value)">
            </div>
            <div class="control-row">
                <span>Right X</span>
                <input type="number" value="0" oninput="moveLogo('logo2', 'left', this.value)">
            </div>
            <div class="control-row">
                <span>Right Y</span>
                <input type="number" value="35" oninput="moveLogo('logo2', 'marginTop', this.value)">
            </div>
        </div>
    </div>

    <script>
        function setVar(name, value) {
            document.documentElement.style.setProperty(name, value);
        }

        function moveLogo(id, prop, val) {
            const el = document.getElementById(id);
            el.style[prop] = val + "px";
        }

        function generatePPT() {
            // This function scrapes the CURRENT DOM state, including user edits
            try {
                let pptx = new PptxGenJS();
                pptx.layout = 'A4';
                let slide = pptx.addSlide();

                // HEADER
                slide.addText("Valli Super Speciality Hospital", { x:1.5, y:0.5, w:5.27, fontSize:22, bold:true, color:'006400', align:'center' });
                slide.addShape(pptx.ShapeType.line, { x:1.6, y:0.9, w:5.0, h:0, line:{color:'000000', width:1} });
                slide.addText("Valli Orthopaedic & Sports Hospital", { x:1.5, y:1.0, w:5.27, fontSize:14, bold:true, color:'000000', align:'center' });
                slide.addText("NABH Accredited", { x:1.5, y:1.25, w:5.27, fontSize:12, bold:true, color:'cc0000', align:'center' });
                slide.addText("DISCHARGE SUMMARY", { x:0.5, y:1.7, w:7.27, fontSize:12, bold:true, underline:true, align:'center' });

                // TABLE - We scrape specific cells for simplicity
                // Note: For a true WYSIWYG PPT export, complex parsing is needed. 
                // This is a robust approximation using the text content.
                
                // Helper to get text from cells roughly
                const getTxt = (selector) => {
                   let el = document.querySelector(selector);
                   return el ? el.innerText.replace(/\n/g, " ") : "";
                };

                let rows = [
                    [
                        { text: "NAME: Mr.TAMILSELVAN.D", options:{bold:true, fontSize:10} },
                        { text: "MRN: 11948", options:{bold:true, fontSize:10} },
                        { text: "IP: 25000307", options:{bold:true, fontSize:10} }
                    ],
                    [
                        { text: "AGE: 29 YEARS", options:{bold:true, fontSize:10} },
                        { text: "SEX: MALE", options:{bold:true, fontSize:10} },
                        { text: "R.NO: IP-2", options:{bold:true, fontSize:10} }
                    ],
                    [
                        { text: "ADDRESS: S/O MR. DEVARAJI, PALLATHUR...\nPHONE: 9843904387", options:{colspan:3, bold:true, fontSize:10} }
                    ],
                    [
                        { text: "D.O.A: 21/07/25", options:{bold:true, fontSize:10} },
                        { text: "D.O.S: 21/07/25", options:{bold:true, fontSize:10} },
                        { text: "D.O.D: 24/07/25", options:{bold:true, fontSize:10} }
                    ],
                    [
                        { text: "CONSULTANTS: DR. T. NATANASABAPATHY...", options:{colspan:3, bold:true, fontSize:10} }
                    ],
                    [
                        { text: "ICD CODE: M00.862", options:{colspan:3, bold:true, fontSize:10} }
                    ]
                ];

                slide.addTable(rows, {
                    x:0.5, y:2.1, w:7.27,
                    colW: [3.2, 2.0, 2.07],
                    border: {pt:1, color:'000000'},
                    valign:'top'
                });

                // BODY CONTENT
                let yPos = 6.2;
                let sections = document.querySelectorAll('.sec-title');
                let lists = document.querySelectorAll('ul');

                for(let i=0; i<sections.length; i++) {
                    slide.addText(sections[i].innerText, { x:0.5, y:yPos, w:7, fontSize:10, bold:true });
                    yPos += 0.25;
                    let items = lists[i].querySelectorAll('li');
                    items.forEach(li => {
                        slide.addText(li.innerText, { x:0.5, y:yPos, w:7, fontSize:10, bullet:true, indent:15 });
                        yPos += 0.25;
                    });
                    yPos += 0.15;
                }

                pptx.writeFile({ fileName: "Discharge_Summary.pptx" });
            } catch(e) {
                alert("Error: " + e.message);
            }
        }
    </script>
</body>
</html>
